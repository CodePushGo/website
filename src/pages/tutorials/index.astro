---
import Layout from '@/layouts/Layout.astro'
import VuePlugins from '@/vue-pages/plugins.vue'
import * as m from '../../paraglide/messages.js'
import { actions } from '@/config/plugins'
import { getCollection } from 'astro:content'

let tuts = await getCollection('plugin', ({ data }) => data.published !== false)
tuts = tuts
  .filter((i) => i.filePath)
  .map((i) => ({
    ...i,
    data: {
      ...i.data,
      slug: i.filePath
        ?.substring(i.filePath.lastIndexOf('/') + 1)
        .replaceAll('.md', '')
        .replaceAll('.git', '')
        .toLowerCase(),
    },
  }))
const finalActions = actions.filter((i) => {
  const t = tuts.find((t) => i.href.includes(`${t.data.slug}.git`))
  if (t) {
    // console.log(i.href, t?.data.slug)
    return true
  }
  return false
})

const title = [Astro.locals.runtimeConfig.public.brand, m.plugins()].join(' | ')
const description = m.plugins_description()

const content = { title, description }
---

<Layout content={content}><VuePlugins actions={finalActions} locale={Astro.locals.locale} client:load /></Layout>
